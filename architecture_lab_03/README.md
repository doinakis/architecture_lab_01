 # architecture_lab_01
## **Τρίτο εργαστήριο αρχιτεκτονικής υπολογιστών (ΤΗΜΜΥ ΑΠΘ)** 
### Δοϊνάκης Μιχάλης 
### e-mail : doinakis@ece.auth.gr

### Εισαγωγή

Στο τρίτο και τελευταίο εργαστήριο μας ζητήθηκε να χρησιμοποιήσουμε ένα ακόμη εργαλείο για να παράξουμε εκτιμήσεις για τη κατανάλωση ισχύος, με βάση τα αποτελὲσματα μας από το δεύτερο εργαστήριο.Θα συγκρίνουμε και τα αποτελέσματα της συνάρτησης κόστους σε σχέση με το EDAP σε κάθε περίπτωση και θα δούμε αν αυτά τα δύο συμβαδίζουν. 

### Εξοικείωση με το McPAT
Παρατηρώντας την έξοδο του McPAT παρατηρούμε εγγραφές που έχουν να κάνουν με το dynamic power και το leakage.Το **Dynamic Power** είναι η ενέργεια που καταναλώνεται απο τη φόρτιση και την αποφόρτιση των χωρητικών φορτίων, όταν το σύτημα αλλάζει κατάσταση. Είναι ανάλογο της συνολικής χωρητικότητας , του ρολογιού , της παρεχόμενης τάσης , και της "ταλάντωσης" της τάσης καθώς αυτή αλλάζει.Το **Leakage** είναι η ενέργεια που καταναλώνεται εξαιτίας της διαρροής ρεύματος από το transistor. Έχουμε δύο είδη leakage:
* **Subthreshold Leakage**  
όπου ένα trsnsistor σε κατάσταση off επιτρέπει μικρή ποσότητα ρεύματος να περνάει μεταξύ της πηγής (source) και της εκροής(drain)  
* **Gate Leakage**  
που οφείλεται στη διαρροή του ρεύματος από την πύλη (gate) του transistor    

Για να κατανοήσουμε καλύτερα τις έννοιες ας φέρουμε ένα παράδειγμα.Αν τρέξουμε δύο διαφορετικά προγράμματα στον ίδιο επεξεργαστή αυτό που θα επηρεαστεί είναι το dynamic power, γιατί θα γίνει διαφορετική φόρτιση και αποφόρτιση των χωρητικών φορτίων.Γενικά, το dynamic power εξαρτάται και από τη δραστηριότητα στον επεξεργαστή και από τον όγκο των δεδομένων που μπορεί να επεξεργαστεί σε μία δεδομένη στιγμή, με το να θέτει τα transistor σε on και off state.Το leakage από την άλλη, είναι στατική κατανάλωση ενέργειας και δεν επηρεάζεται από την δραστηριότητα στον επεξεργαστή, αλλά μόνο από το ρεύμα που διαρρέει τα transtistor, όπως αναφέρθηκε και προηγουμένως.Για το dynamic power έχει σημασία και ο χρόνος εκτέλεσης του προγράμματος, ενώ το leakage δείχνει και το πόση ενέργεια θα κατανάλωνει το σύστημα αν βρίσκεται σε κατάσταση idle. 

#### Έστω ότι έχετε ένα σύστημα που τροφοδοτείται από μπαταρία συγκεκριμένης χωρητικότητας και έχετε την επιλογή να βάλετε στο σύστημα αυτό δύο διαφορετικούς επεξεργαστές. Έστω ότι ο ένας καταναλώνει 5 Watt και ο άλλος 40 Watt. Υπάρχει περίπτωση ο δεύτερος επεξεργαστής να δίνει στο σύστημα μεγαλύτερη διάρκεια μπαταρίας;  

Η σύντομη απάντηση είναι ναι υπάρχει περίπτωση να διαρκεί περισσότερο η μπαταρία, αλλά ας το πάρουμε από την αρχή.Αρχικά, αν υποθέσουμε ότι είχαμε αυτούς τους δύο επεξεργαστές σε κατάσταση idle χωρίς την εκτέλεση κάποιου task, τότε στο σύστημα με τα 40 Watt(Joule/s) θα τελείωνε πιο γρήγορα η μπαταρία εξαιτίας του περισσότερου leakage που θα υπήρχε λόγω των περισσότερων Watt.Από αυτή την οπτική το McPAT μας δίνει πληροφορία για τη διάρκεια της μπαταρίας. Ωστόσο, αυτό που θα πρέπει να λάβουμε υπόψιν είναι το energy efficiency, δηλαδή η ενέργεια που απαιτείται από τον κάθε επεξεργαστή για την εκτέλεση του ίδιου task.Αν για παράδειγμα έχουμε μία εφαρμογή η οποία τρέχει σε χρόνο 1 second και στους 2 επεξεργαστες τότε η ενέργεια που καταναλώνει ο πρώτος είναι 5 Joule ενώ ο δεύτερος 40 Joule.Για να φτάσουν να καταναλώνουν την ίδια ενέργεια θα πρέπει ο δεύτερος να είναι 8 φορές γρηγορότερος από τον πρώτο, δηλαδή ο πρώτος να χρειάζεται χρόνο 8 seconds και να καταναλώνει ενέργεια 40 Joule και ο δεύτερος χρόνο 1 second και ενέργεια 40 Joule.Για να διαρκέσει , λοιπόν, η μπαταρία στον δεύτερο περισσότερη ώρα, ή καλύτερα να πούμε για να καταναλώσει μικρότερο ποσό ενέργειας από την μπαταρία για το ίδιο task, θα πρέπει να είναι πάνω από 8 φορές γρηγορότερος σε σχέση με τον επεξεργαστή με τα 5 Watt, το οποίο είναι δυνατό να συμβεί.Επίσης, με το παράδειγμα που έφερα καταλαβαίνουμε ποια πληροφορία είναι αυτή που δεν μας παρέχεται από το McPAT και είναι αυτή του χρόνου.Το McPAT δεν μας δίνει πληροφορία για το πόσο χρόνο παίρνει το εκάστοτε πρόγραμμα για να τρέξει στον επεξεργαστή που εξομοιώνει, αλλά μας δίνει πληροφορία για το πόση ενέργεια καταναλώνει ανα δευτερόλεπτο ο επεξεργαστής.Ευτυχώς για εμάς όμως την πληροφορία αυτή μπορούμε να την αντλήσουμε από το gem5 😊(sim_seconds).  
#### Ας κάνουμε μια εντελώς αυθαίρετη υπόθεση και ας υποθέσουμε ότι oXeonμπορεί να τρέξει την ίδια εφαρμογή με τον Α9, 40 φορές γρηγορότερα. Υποθέτοντας ότι δεν διακόπτεται η λειτουργία του συστήματος μετά την ολοκλήρωση εκτέλεσης της εφαρμογής(δλδ δεν απενεργοποιείται με κάποιο τρόπο το σύστημα), εξηγείστε χρησιμοποιώντας το McPAT γιατί o Xeon δεν μπορεί να είναι πιο energy efficientαπό τον A9 παρά τη διαφορά στην απόδοση.

|RESULTS         |ARM_A9      | XEON      | 
| :------------- |:----------:| :--------:| 
| Total Leakage  | 0.108687 W | 36.8319 W | 
| Runtime Dynamic| 2.96053 W  | 72.9199 W | 
